apiVersion: v1
kind: ConfigMap
metadata:
  name: samba-config
  namespace: samba
  labels:
    app.kubernetes.io/name: samba
    app.kubernetes.io/component: configuration
data:
  smb.conf: |
    [global]
    workgroup = HOMELAB
    netbios name = k8s-samba
    security = user
    passdb backend = ldapsam:ldap://openldap-ldap.openldap.svc.cluster.local:389
    ldap suffix = dc=kojigenba-srv,dc=com
    ldap user suffix = ou=people
    ldap group suffix = ou=groups
    ldap admin dn = cn=admin,dc=kojigenba-srv,dc=com
    ldap passwd sync = yes
    ldap timeout = 10
    ldap ssl = off

    # Performance Optimization
    socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=524288 SO_SNDBUF=524288
    use sendfile = yes
    aio read size = 16384
    aio write size = 16384
    read raw = yes
    write raw = yes
    max xmit = 65535
    min receivefile size = 16384
    getwd cache = yes
    strict allocate = yes
    strict sync = no
    sync always = no

    [shared]
    path = /mnt/shared
    comment = Shared Storage
    browseable = yes
    writable = yes
    create mask = 0600
    directory mask = 0700
    valid users = @samba-users

    [archive]
    path = /mnt/archive
    comment = Archive Storage
    browseable = yes
    writable = yes
    create mask = 0600
    directory mask = 0700
    valid users = @samba-users
